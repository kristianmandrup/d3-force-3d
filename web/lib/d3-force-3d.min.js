// https://github.com/vasturiano/d3-force-3d Version 1.1.0. Copyright 2018 Vasco Asturiano.
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-binarytree"),require("d3-quadtree"),require("d3-octree"),require("d3-collection"),require("d3-dispatch"),require("d3-timer")):"function"==typeof define&&define.amd?define(["exports","d3-binarytree","d3-quadtree","d3-octree","d3-collection","d3-dispatch","d3-timer"],t):t(n.d3=n.d3||{},n.d3,n.d3,n.d3,n.d3,n.d3,n.d3)}(this,function(n,c,l,z,p,g,x){"use strict";function M(n){return function(){return n}}function D(){return 1e-6*(Math.random()-.5)}function h(n){return n.x+n.vx}function v(n){return n.y+n.vy}function y(n){return n.z+n.vz}function q(n){return n.index}function N(n,t){var r=n.get(t);if(!r)throw new Error("missing: "+t);return r}var m=3;function f(n){return n.x}function a(n){return n.y}function w(n){return n.z}var A=10,b=Math.PI*(3-Math.sqrt(5)),k=Math.PI/24;n.forceCenter=function(o,f,a){var c;function t(){var n,t,r=c.length,e=0,i=0,u=0;for(n=0;n<r;++n)e+=(t=c[n]).x||0,i+=t.y||0,u+=t.z||0;for(e=e/r-o,i=i/r-f,u=u/r-a,n=0;n<r;++n)t=c[n],e&&(t.x-=e),i&&(t.y-=i),u&&(t.z-=u)}return null==o&&(o=0),null==f&&(f=0),null==a&&(a=0),t.initialize=function(n){c=n},t.x=function(n){return arguments.length?(o=+n,t):o},t.y=function(n){return arguments.length?(f=+n,t):f},t.z=function(n){return arguments.length?(a=+n,t):a},t},n.forceCollide=function(e){var u,k,o,j=1,f=1;function t(){for(var n,t,q,N,m,w,A,b,r=u.length,e=0;e<f;++e)for(t=(1===k?c.binarytree(u,h):2===k?l.quadtree(u,h,v):3===k?z.octree(u,h,v,y):null).visitAfter(a),n=0;n<r;++n)q=u[n],A=o[q.index],b=A*A,N=q.x+q.vx,1<k&&(m=q.y+q.vy),2<k&&(w=q.z+q.vz),t.visit(i);function i(n,t,r,e,i,u,o){var f=[t,r,e,i,u,o],a=f[0],c=f[1],l=f[2],h=f[k],v=f[k+1],y=f[k+2],d=n.data,s=n.r,g=A+s;if(!d)return N+g<a||h<N-g||1<k&&(m+g<c||v<m-g)||2<k&&(w+g<l||y<w-g);if(d.index>q.index){var x=N-d.x-d.vx,z=1<k?m-d.y-d.vy:0,p=2<k?w-d.z-d.vz:0,M=x*x+z*z+p*p;M<g*g&&(0===x&&(M+=(x=D())*x),1<k&&0===z&&(M+=(z=D())*z),2<k&&0===p&&(M+=(p=D())*p),M=(g-(M=Math.sqrt(M)))/M*j,q.vx+=(x*=M)*(g=(s*=s)/(b+s)),1<k&&(q.vy+=(z*=M)*g),2<k&&(q.vz+=(p*=M)*g),d.vx-=x*(g=1-g),1<k&&(d.vy-=z*g),2<k&&(d.vz-=p*g))}}}function a(n){if(n.data)return n.r=o[n.data.index];for(var t=n.r=0;t<Math.pow(2,k);++t)n[t]&&n[t].r>n.r&&(n.r=n[t].r)}function r(){if(u){var n,t,r=u.length;for(o=new Array(r),n=0;n<r;++n)t=u[n],o[t.index]=+e(t,n,u)}}return"function"!=typeof e&&(e=M(null==e?1:+e)),t.initialize=function(n,t){u=n,k=t,r()},t.iterations=function(n){return arguments.length?(f=+n,t):f},t.strength=function(n){return arguments.length?(j=+n,t):j},t.radius=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),r(),t):e},t},n.forceLink=function(v){var y,d,u,s,o,g,f=q,r=function(n){return 1/Math.min(o[n.source.index],o[n.target.index])},e=M(30),x=1;function t(n){for(var t=0,r=v.length;t<x;++t)for(var e,i,u,o,f,a=0,c=0,l=0,h=0;a<r;++a)i=(e=v[a]).source,c=(u=e.target).x+u.vx-i.x-i.vx||D(),1<s&&(l=u.y+u.vy-i.y-i.vy||D()),2<s&&(h=u.z+u.vz-i.z-i.vz||D()),c*=o=((o=Math.sqrt(c*c+l*l+h*h))-d[a])/o*n*y[a],l*=o,h*=o,u.vx-=c*(f=g[a]),1<s&&(u.vy-=l*f),2<s&&(u.vz-=h*f),i.vx+=c*(f=1-f),1<s&&(i.vy+=l*f),2<s&&(i.vz+=h*f)}function i(){if(u){var n,t,r=u.length,e=v.length,i=p.map(u,f);for(n=0,o=new Array(r);n<e;++n)(t=v[n]).index=n,"object"!=typeof t.source&&(t.source=N(i,t.source)),"object"!=typeof t.target&&(t.target=N(i,t.target)),o[t.source.index]=(o[t.source.index]||0)+1,o[t.target.index]=(o[t.target.index]||0)+1;for(n=0,g=new Array(e);n<e;++n)t=v[n],g[n]=o[t.source.index]/(o[t.source.index]+o[t.target.index]);y=new Array(e),a(),d=new Array(e),c()}}function a(){if(u)for(var n=0,t=v.length;n<t;++n)y[n]=+r(v[n],n,v)}function c(){if(u)for(var n=0,t=v.length;n<t;++n)d[n]=+e(v[n],n,v)}return null==v&&(v=[]),t.initialize=function(n,t){u=n,s=t,i()},t.links=function(n){return arguments.length?(v=n,i(),t):v},t.id=function(n){return arguments.length?(f=n,t):f},t.iterations=function(n){return arguments.length?(x=+n,t):x},t.strength=function(n){return arguments.length?(r="function"==typeof n?n:M(+n),a(),t):r},t.distance=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),c(),t):e},t},n.forceManyBody=function(){var i,h,v,y,d,e=M(-30),s=1,g=1/0,x=.81;function t(n){var t,r=i.length,e=(1===h?c.binarytree(i,f):2===h?l.quadtree(i,f,a):3===h?z.octree(i,f,a,w):null).visitAfter(u);for(y=n,t=0;t<r;++t)v=i[t],e.visit(o)}function r(){if(i){var n,t,r=i.length;for(d=new Array(r),n=0;n<r;++n)t=i[n],d[t.index]=+e(t,n,i)}}function u(n){var t,r,e,i,u,o,f=0,a=0;if(n.length){for(e=i=u=o=0;o<4;++o)(t=n[o])&&(r=Math.abs(t.value))&&(f+=t.value,a+=r,e+=r*(t.x||0),i+=r*(t.y||0),u+=r*(t.z||0));n.x=e/a,1<h&&(n.y=i/a),2<h&&(n.z=u/a)}else for((t=n).x=t.data.x,1<h&&(t.y=t.data.y),2<h&&(t.z=t.data.z);f+=d[t.data.index],t=t.next;);n.value=f}function o(n,t,r,e,i){if(!n.value)return!0;var u=[r,e,i][h-1],o=n.x-v.x,f=1<h?n.y-v.y:0,a=2<h?n.z-v.z:0,c=u-t,l=o*o+f*f+a*a;if(c*c/x<l)return l<g&&(0===o&&(l+=(o=D())*o),1<h&&0===f&&(l+=(f=D())*f),2<h&&0===a&&(l+=(a=D())*a),l<s&&(l=Math.sqrt(s*l)),v.vx+=o*n.value*y/l,1<h&&(v.vy+=f*n.value*y/l),2<h&&(v.vz+=a*n.value*y/l)),!0;if(!(n.length||g<=l))for((n.data!==v||n.next)&&(0===o&&(l+=(o=D())*o),1<h&&0===f&&(l+=(f=D())*f),2<h&&0===a&&(l+=(a=D())*a),l<s&&(l=Math.sqrt(s*l)));n.data!==v&&(c=d[n.data.index]*y/l,v.vx+=o*c,1<h&&(v.vy+=f*c),2<h&&(v.vz+=a*c)),n=n.next;);}return t.initialize=function(n,t){i=n,h=t,r()},t.strength=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),r(),t):e},t.distanceMin=function(n){return arguments.length?(s=n*n,t):Math.sqrt(s)},t.distanceMax=function(n){return arguments.length?(g=n*n,t):Math.sqrt(g)},t.theta=function(n){return arguments.length?(x=n*n,t):Math.sqrt(x)},t},n.forceRadial=function(r,c,l,h){var v,y,d,s,e=M(.1);function t(n){for(var t=0,r=v.length;t<r;++t){var e=v[t],i=e.x-c||1e-6,u=(e.y||0)-l||1e-6,o=(e.z||0)-h||1e-6,f=Math.sqrt(i*i+u*u+o*o),a=(s[t]-f)*d[t]*n/f;e.vx+=i*a,1<y&&(e.vy+=u*a),2<y&&(e.vz+=o*a)}}function i(){if(v){var n,t=v.length;for(d=new Array(t),s=new Array(t),n=0;n<t;++n)s[n]=+r(v[n],n,v),d[n]=isNaN(s[n])?0:+e(v[n],n,v)}}return"function"!=typeof r&&(r=M(+r)),null==c&&(c=0),null==l&&(l=0),null==h&&(h=0),t.initialize=function(n,t){v=n,y=t,i()},t.strength=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),i(),t):e},t.radius=function(n){return arguments.length?(r="function"==typeof n?n:M(+n),i(),t):r},t.x=function(n){return arguments.length?(c=+n,t):c},t.y=function(n){return arguments.length?(l=+n,t):l},t.z=function(n){return arguments.length?(h=+n,t):h},t},n.forceSimulation=function(y,n){n=n||2;var r,d=Math.min(m,Math.max(1,Math.round(n))),e=1,t=.001,i=1-Math.pow(t,1/300),u=0,o=.6,f=p.map(),a=x.timer(l),c=g.dispatch("tick","end");function l(){h(),c.call("tick",r),e<t&&(a.stop(),c.call("end",r))}function h(){var n,t,r=y.length;for(e+=(u-e)*i,f.each(function(n){n(e)}),n=0;n<r;++n)null==(t=y[n]).fx?t.x+=t.vx*=o:(t.x=t.fx,t.vx=0),1<d&&(null==t.fy?t.y+=t.vy*=o:(t.y=t.fy,t.vy=0)),2<d&&(null==t.fz?t.z+=t.vz*=o:(t.z=t.fz,t.vz=0))}function v(){for(var n,t=0,r=y.length;t<r;++t){if((n=y[t]).index=t,isNaN(n.x)||1<d&&isNaN(n.y)||2<d&&isNaN(n.z)){var e=A*(2<d?Math.cbrt(t):1<d?Math.sqrt(t):t),i=t*b,u=t*k;n.x=e*(1<d?Math.cos(i):1),1<d&&(n.y=e*Math.sin(i)),2<d&&(n.z=e*Math.sin(u))}(isNaN(n.vx)||1<d&&isNaN(n.vy)||2<d&&isNaN(n.vz))&&(n.vx=0,1<d&&(n.vy=0),2<d&&(n.vz=0))}}function s(n){return n.initialize&&n.initialize(y,d),n}return null==y&&(y=[]),v(),r={tick:h,restart:function(){return a.restart(l),r},stop:function(){return a.stop(),r},numDimensions:function(n){return arguments.length?(d=Math.min(m,Math.max(1,Math.round(n))),f.each(s),r):d},nodes:function(n){return arguments.length?(y=n,v(),f.each(s),r):y},alpha:function(n){return arguments.length?(e=+n,r):e},alphaMin:function(n){return arguments.length?(t=+n,r):t},alphaDecay:function(n){return arguments.length?(i=+n,r):+i},alphaTarget:function(n){return arguments.length?(u=+n,r):u},velocityDecay:function(n){return arguments.length?(o=1-n,r):1-o},force:function(n,t){return 1<arguments.length?(null==t?f.remove(n):f.set(n,s(t)),r):f.get(n)},find:function(){var n,t,r,e,i,u,o=Array.prototype.slice.call(arguments),f=o.shift()||0,a=(1<d?o.shift():null)||0,c=(2<d?o.shift():null)||0,l=o.shift()||1/0,h=0,v=y.length;for(l*=l,h=0;h<v;++h)(e=(n=f-(i=y[h]).x)*n+(t=a-(i.y||0))*t+(r=c-(i.z||0))*r)<l&&(u=i,l=e);return u},on:function(n,t){return 1<arguments.length?(c.on(n,t),r):c.on(n)}}},n.forceX=function(r){var i,u,o,e=M(.1);function t(n){for(var t,r=0,e=i.length;r<e;++r)(t=i[r]).vx+=(o[r]-t.x)*u[r]*n}function f(){if(i){var n,t=i.length;for(u=new Array(t),o=new Array(t),n=0;n<t;++n)u[n]=isNaN(o[n]=+r(i[n],n,i))?0:+e(i[n],n,i)}}return"function"!=typeof r&&(r=M(null==r?0:+r)),t.initialize=function(n){i=n,f()},t.strength=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),f(),t):e},t.x=function(n){return arguments.length?(r="function"==typeof n?n:M(+n),f(),t):r},t},n.forceY=function(r){var i,u,o,e=M(.1);function t(n){for(var t,r=0,e=i.length;r<e;++r)(t=i[r]).vy+=(o[r]-t.y)*u[r]*n}function f(){if(i){var n,t=i.length;for(u=new Array(t),o=new Array(t),n=0;n<t;++n)u[n]=isNaN(o[n]=+r(i[n],n,i))?0:+e(i[n],n,i)}}return"function"!=typeof r&&(r=M(null==r?0:+r)),t.initialize=function(n){i=n,f()},t.strength=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),f(),t):e},t.y=function(n){return arguments.length?(r="function"==typeof n?n:M(+n),f(),t):r},t},n.forceZ=function(r){var i,u,o,e=M(.1);function t(n){for(var t,r=0,e=i.length;r<e;++r)(t=i[r]).vz+=(o[r]-t.z)*u[r]*n}function f(){if(i){var n,t=i.length;for(u=new Array(t),o=new Array(t),n=0;n<t;++n)u[n]=isNaN(o[n]=+r(i[n],n,i))?0:+e(i[n],n,i)}}return"function"!=typeof r&&(r=M(null==r?0:+r)),t.initialize=function(n){i=n,f()},t.strength=function(n){return arguments.length?(e="function"==typeof n?n:M(+n),f(),t):e},t.z=function(n){return arguments.length?(r="function"==typeof n?n:M(+n),f(),t):r},t},Object.defineProperty(n,"__esModule",{value:!0})});